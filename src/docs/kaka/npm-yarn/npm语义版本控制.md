<!--
 * @Description: npm&yarn文件夹
 * @Author: xiehuaqiang
 * @FilePath: /kaka-blog/src/docs/kaka/npm-yarn/npm语义版本控制.md
 * @Date: 2021-04-07 10:21:27
 * @LastEditTime: 2021-10-25 20:40:33
-->

# 使用 npm 的语义版本控制

语义版本控制的概念很简单：所有的版本都有 3 个数字：x.y.z。

- 第一个数字是主版本。
- 第二个数字是次版本。
- 第三个数字是补丁版本。

当发布新的版本时，不仅仅是随心所欲地增加数字，还要遵循以下规则：

- 当进行不兼容的 API 更改时，则升级主版本。
- 当以向后兼容的方式添加功能时，则升级次版本。
- 当进行向后兼容的缺陷修复时，则升级补丁版本。

该约定在所有编程语言中均被采用，每个`npm`软件包都必须遵守该约定，这一点非常重要，因为整个系统都依赖于此。

为什么这么重要？

因为 `npm` 设置了一些规则，可用于在 package.json 文件中选择要将软件包更新到的版本（当运行 `npm update` 时）。

规则使用了这些符号：

- `^` 插入号
- `~` 波浪号
- `>`
- `>=`
- `<`
- `<=`
- `=`
- `-`
- `||`

这些规则的详情如下：

- `^`: **如果写入的是 ^0.13.0，则当运行 npm update 时，会更新到补丁版本和次版本：即 0.13.1、0.14.0、依此类推。**
- `~`: **如果写入的是 〜0.13.0，则当运行 npm update 时，会更新到补丁版本：即 0.13.1 可以，但 0.14.0 不可以。**
- `>`: **接受高于指定版本的任何版本。**
- `>=`: **接受等于或高于指定版本的任何版本。**
- `<=`: **接受等于或低于指定版本的任何版本。**
- `<`: **接受低于指定版本的任何版本。**
- `=`: **接受确切的版本。**
- `-`: **接受一定范围的版本。** 例如：2.1.0 - 2.6.2。
- `||`: **组合集合。** 例如 < 2.1 || > 2.6。

可以合并其中的一些符号，例如 `1.0.0 || >=1.1.0 <1.2.0`，即使用 1.0.0 或从 1.1.0 开始但低于 1.2.0 的版本。

还有其他的规则：

- 无符号: 仅接受指定的特定版本（例如 1.2.1）。
- latest: 使用可用的最新版本。

## 补充

- 第四部分为日期版本号加希腊字母版本号，希腊字母版本号共有五种，分别为base、alpha、beta 、RC 、 release

### 关于希腊版本号

- **Base**  
此版本表示该软件仅仅是一个假页面链接，通常包括所有的功能和页面布局，但是 页面中的功能都没有做完整的实现，只是做为整体网站的一个基础架构。

- **Alpha**  
软件的初级版本，表示该软件在此阶段以实现软件功能为主，通常只在软件开发者 内部交流，一般而言，该版本软件的Bug较多，需要继续修改，是测试版本。测试 人员提交Bug经开发人员修改确认之后，发布到测试网址让测试人员测试，此时可 将软件版本标注为alpha版。

- **Beta**  
该版本相对于Alpha 版已经有了很大的进步，消除了严重错误，但还需要经过多次 测试来进一步消除，此版本主要的修改对象是软件的UI。修改的的Bug 经测试人 员测试确认后可发布到外网上，此时可将软件版本标注为 beta版。

- **RC**  
该版本已经相当成熟，基本上不存在导致错误的Bug，与即将发行的正式版本相差无几。

- **Release**  
该版本意味“最终版本”，在前面版本的一系列测试版之后，终归会有一个正式的版本，是最终交付用户使用的一个版本。该版本有时也称标准版。

```json
{
  "dependencies": {
    "foo": "1.0.0 - 2.9999.9999",
    "bar": ">=1.0.2 <2.1.2",        // 必须大于等于1.0.2版本且小于2.1.2版本
    "baz": ">1.0.2 <=2.3.4",        // 必须大于1.0.2版本且小于等于2.3.4版本
    "boo": "2.3.1",                 // 必须匹配这个版本
    "boo": "~2.3.1",                // 约等于2.3.1，只更新最小版本，相当于2.3.X，即>=2.3.1 <2.4.0
    "boo": "^2.3.1",                // 与2.3.1版本兼容，相当于2.X.X, 即>=2.3.1 < 3.0.0,不改变大版本号。
    "asd": "http://asdf.com/asdf.tar.gz",   // 在版本上指定一个压缩包的url，当执行npm install 时这个压缩包会被下载并安装到本地。
    "lat": "latest",                // 安装最新版本
    "dyl": "file:../dyl",           // 使用本地路径
    "qux": "<1.0.0 || >=2.3.1 <2.4.5 || >=2.5.2 <3.0.0",
    "adf": "git://github.com/user/project.git#commit-ish"    // 使用git URL加commit-ish
  }
}

```

[使用 npm 的语义版本控制·node.js](http://nodejs.cn/learn/semantic-versioning-using-npm)  
[package.json中版本号详解](https://blog.csdn.net/weixin_40817115/article/details/86611179)

## npm 执行顺序

如果 npm 脚本里面需要执行多个任务，那么需要明确它们的执行顺序。

如果是并行执行（即同时的平行执行），可以使用`&`符号。

```sh
npm run script1.js & npm run script2.js
```

如果是继发执行（即只有前一个任务成功，才执行下一个任务），可以使用`&&`符号。

```sh
npm run script1.js && npm run script2.js
```

这两个符号是 Bash 的功能。

[npm scripts 使用指南·阮一峰](http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html)
