(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d21e5c6"],{d4dd:function(s,a,e){"use strict";e.r(a);var r=e("2877"),t=Object(r.a)({},(function(){var s=this;s.$createElement;return s._self._c,s._m(0)}),[function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("section",[e("html",[e("head"),e("body",[e("h1",[s._v("js 实现使用文件流下载文件")]),e("h2",[s._v("1. 理解 Blob 对象")]),e("p",[s._v("在 "),e("code",{pre:!0},[s._v("Blob")]),s._v(" 对象出现之前，在 "),e("code",{pre:!0},[s._v("javascript")]),s._v(" 中一直没有比较好的方式处理二进制文件，自从有了 "),e("code",{pre:!0},[s._v("Blob")]),s._v(" 了，我们就可以使用它操作二进制数据了。现在我们开始来理解下 "),e("code",{pre:!0},[s._v("Bolb")]),s._v(" 对象及它的文件流下载应用场景.")]),e("h2",[s._v("2. 创建 Blob 对象")]),e("ul",[e("li",[e("p",[s._v("创建一个 blob 对象")]),e("pre",{pre:!0},[e("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" blob = "),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" "),e("span",{pre:!0,attrs:{class:"hljs-title class_"}},[s._v("Blob")]),s._v("(dataArray, options)\n")])]),e("p",[s._v("dataArray: 它是一个数组，它包含了要添加到 Blob 对象中的数据。数组可以是二进制对象或者字符串。")]),e("p",[s._v("options 是可选的对象参数，用于设置数组中数据的 MIME 类型。")])]),e("li",[e("p",[s._v("2.1. 创建一个 DOMString 对象的 Blob 对象。如下代码：")]),e("pre",{pre:!0},[e("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" str = "),e("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'<div>Hello World</div>'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" blob = "),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" "),e("span",{pre:!0,attrs:{class:"hljs-title class_"}},[s._v("Blob")]),s._v("([str], { "),e("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("type")]),s._v(": "),e("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'text/xml'")]),s._v(" })\n"),e("span",{pre:!0,attrs:{class:"hljs-variable language_"}},[s._v("console")]),s._v("."),e("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("log")]),s._v("(blob) "),e("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v('// 输出：Blob {size: 22, type: "text/xml"}')]),s._v("\n")])])])]),e("h2",[s._v("3. 理解 URL.createObjectURL 对象")]),e("p",[e("code",{pre:!0},[s._v("window")]),s._v(" 对象的 "),e("code",{pre:!0},[s._v("URL")]),s._v(" 对象是用来将 "),e("code",{pre:!0},[s._v("blob")]),s._v(" 或 "),e("code",{pre:!0},[s._v("file")]),s._v(" 读取成一个 "),e("code",{pre:!0},[s._v("url")]),s._v(" 的。")]),e("pre",{pre:!0},[e("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[e("span",{pre:!0,attrs:{class:"hljs-variable language_"}},[s._v("window")]),s._v("."),e("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("URL")]),s._v("."),e("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("createObjectURL")]),s._v("(file / blob)\n")])]),e("p",[s._v("比如我现在结合上面的 blob 对象来生成一个 url 的简单 demo 实列如下所示：")]),e("pre",{pre:!0},[e("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" str = "),e("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'<div>Hello World</div>'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" blob = "),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" "),e("span",{pre:!0,attrs:{class:"hljs-title class_"}},[s._v("Blob")]),s._v("([str], {\n  "),e("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("type")]),s._v(":\n    "),e("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'.csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel'")]),s._v("\n})\n"),e("span",{pre:!0,attrs:{class:"hljs-variable language_"}},[s._v("console")]),s._v("."),e("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("log")]),s._v("(blob)\n\n"),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" url3 = "),e("span",{pre:!0,attrs:{class:"hljs-variable language_"}},[s._v("window")]),s._v("."),e("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("URL")]),s._v("."),e("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("createObjectURL")]),s._v("(blob)\n"),e("span",{pre:!0,attrs:{class:"hljs-variable language_"}},[s._v("console")]),s._v("."),e("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("log")]),s._v("(url3)\n")])]),e("p",[s._v("如上代码第一个打印 blob 变量值如下：")]),e("pre",{pre:!0},[e("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[e("span",{pre:!0,attrs:{class:"hljs-title class_"}},[s._v("Blob")]),s._v(" {"),e("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("size")]),s._v(": "),e("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("22")]),s._v(", "),e("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("type")]),s._v(": "),e("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"')]),s._v("}\n")])]),e("p",[s._v("打印第二个 url3 变量值信息如下：")]),e("pre",{pre:!0},[e("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[e("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("blob")]),s._v(":"),e("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("null")]),s._v("/2c75a56e-"),e("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0104")]),s._v("-"),e("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("4572")]),s._v("-bc19-391d3bf93d9d\n")])]),e("h2",[s._v("4. 理解 HTML5 中 a 标签的 download 属性")]),e("p",[e("code",{pre:!0},[s._v("HTMl5")]),s._v(" 中给 "),e("code",{pre:!0},[s._v("<a>")]),s._v(" 标签新增了一个 "),e("code",{pre:!0},[s._v("download")]),s._v(" 属性，只要我们设置该属性值，那么点击该链接时浏览器不会打开新链接，而是会直接下载文件，并且文件名就是 "),e("code",{pre:!0},[s._v("download")]),s._v(" 的属性值。")]),e("p",[s._v("因此结合这个特点，我们就可以简单的实现文件流下载文件了，我们首先在原来的代码基础之上，再动态创建一个 "),e("code",{pre:!0},[s._v("<a>")]),s._v(" 链接，然后把该 "),e("code",{pre:!0},[s._v("<a>")]),s._v(" 标签的样式设置 "),e("code",{pre:!0},[s._v("none")]),s._v(", 该链接的 "),e("code",{pre:!0},[s._v("href")]),s._v(" 属性 就是我们上面是有 "),e("code",{pre:!0},[s._v("window.URL.createObjectURL(blob)")]),s._v(" 生成的 "),e("code",{pre:!0},[s._v("url")]),s._v("，然后我们把 "),e("code",{pre:!0},[s._v("<a>")]),s._v(" 链接的 "),e("code",{pre:!0},[s._v("download")]),s._v(" 属性设置下，该属性值就是我们的下载文件的文件名。最后触发点击功能即可下载了。如下代码：")]),e("pre",{pre:!0},[e("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" str = "),e("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'<div>Hello World</div>'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" blob = "),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" "),e("span",{pre:!0,attrs:{class:"hljs-title class_"}},[s._v("Blob")]),s._v("([str], {\n  "),e("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("type")]),s._v(":\n    "),e("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'.csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel'")]),s._v("\n})\n"),e("span",{pre:!0,attrs:{class:"hljs-variable language_"}},[s._v("console")]),s._v("."),e("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("log")]),s._v("(blob)\n"),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" url3 = "),e("span",{pre:!0,attrs:{class:"hljs-variable language_"}},[s._v("window")]),s._v("."),e("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("URL")]),s._v("."),e("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("createObjectURL")]),s._v("(blob)\n"),e("span",{pre:!0,attrs:{class:"hljs-variable language_"}},[s._v("console")]),s._v("."),e("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("log")]),s._v("(url3)\n\n"),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" filename = "),e("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'文件流下载'")]),s._v(" + "),e("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'.csv'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" link = "),e("span",{pre:!0,attrs:{class:"hljs-variable language_"}},[s._v("document")]),s._v("."),e("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("createElement")]),s._v("("),e("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'a'")]),s._v(")\nlink."),e("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("style")]),s._v("."),e("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("display")]),s._v(" = "),e("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'none'")]),s._v("\nlink."),e("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("href")]),s._v(" = url3\nlink."),e("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("setAttribute")]),s._v("("),e("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'download'")]),s._v(", filename)\n"),e("span",{pre:!0,attrs:{class:"hljs-variable language_"}},[s._v("document")]),s._v("."),e("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("body")]),s._v("."),e("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("appendChild")]),s._v("(link)\nlink."),e("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("click")]),s._v("()\n")])])])])])}],!1,null,null,null);a.default=t.exports}}]);