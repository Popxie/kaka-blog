(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d21ee50"],{d806:function(s,e,a){"use strict";a.r(e);var t=a("2877"),r=Object(t.a)({},(function(){var s=this;s.$createElement;return s._self._c,s._m(0)}),[function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("section",[a("html",[a("head"),a("body",[a("h1",[s._v("07 执行上下文")]),a("blockquote",[a("p",[s._v("JavaScript 深入系列第七篇，结合之前所讲的四篇文章，以权威指南的 demo 为例，具体讲解当函数执行的时候，执行上下文栈、变量对象、作用域链是如何变化的。")])]),a("h2",[s._v("前言")]),a("p",[s._v("在"),a("a",{attrs:{href:"#/qingfeng/deep/deep-03"}},[s._v("《03 执行上下文栈》")]),s._v("中讲到，当 JavaScript 代码执行一段可执行代码(executable code)时，会创建对应的执行上下文(execution contexts)。")]),a("p",[s._v("对于每个执行上下文，都有三个重要属性：")]),a("ul",[a("li",[s._v("变量对象(Variable object，VO)")]),a("li",[s._v("作用域链(Scope chain)")]),a("li",[s._v("this")])]),a("p",[s._v("然后分别在"),a("a",{attrs:{href:"#/qingfeng/deep/deep-04"}},[s._v("《04 变量对象》")]),s._v("、"),a("a",{attrs:{href:"#/qingfeng/deep/deep-05"}},[s._v("《05 作用域链》")]),s._v("、"),a("a",{attrs:{href:"#/qingfeng/deep/deep-06"}},[s._v("《06 从 ECMAScript 规范解读 this》")]),s._v("中讲解了这三个属性。")]),a("p",[s._v("阅读本文前，如果对以上的概念不是很清楚，希望先阅读这些文章。")]),a("p",[s._v("因为，这一篇，我们会结合着所有内容，讲讲执行上下文的具体处理过程。")]),a("h2",[s._v("思考题")]),a("p",[s._v("在"),a("a",{attrs:{href:"#/qingfeng/deep/deep-02"}},[s._v("《02 词法作用域和动态作用域》")]),s._v("中，提出这样一道思考题：")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" scope = "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'global scope'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("checkscope")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") {\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" scope = "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'local scope'")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("f")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") {\n    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" scope\n  }\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("f")]),s._v("()\n}\n"),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("checkscope")]),s._v("()\n")])]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" scope = "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'global scope'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("checkscope")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") {\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" scope = "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'local scope'")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("f")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") {\n    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" scope\n  }\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" f\n}\n"),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("checkscope")]),s._v("()()\n")])]),a("p",[s._v("两段代码都会打印'local scope'。虽然两段代码执行的结果一样，但是两段代码究竟有哪些不同呢？")]),a("p",[s._v("紧接着就在下一篇"),a("a",{attrs:{href:"#/qingfeng/deep/deep-04"}},[s._v("《04执行上下文栈》")]),s._v("中，讲到了两者的区别在于执行上下文栈的变化不一样，然而，如果是这样笼统的回答，依然显得不够详细，本篇就会详细的解析执行上下文栈和执行上下文的具体变化过程。")]),a("h2",[s._v("具体执行分析")]),a("p",[s._v("我们分析第一段代码：")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" scope = "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'global scope'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("checkscope")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") {\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" scope = "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'local scope'")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("f")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") {\n    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" scope\n  }\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("f")]),s._v("()\n}\n"),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("checkscope")]),s._v("()\n")])]),a("p",[s._v("执行过程如下：")]),a("p",[s._v("1.执行全局代码，创建全局执行上下文，全局上下文被压入执行上下文栈")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[a("span",{pre:!0,attrs:{class:"hljs-title class_"}},[s._v("ECStack")]),s._v(" = [globalContext]\n")])]),a("p",[s._v("2.全局上下文初始化")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[s._v("globalContext = {\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("VO")]),s._v(": ["),a("span",{pre:!0,attrs:{class:"hljs-variable language_"}},[s._v("global")]),s._v(", scope, checkscope],\n  "),a("span",{pre:!0,attrs:{class:"hljs-title class_"}},[s._v("Scope")]),s._v(": [globalContext."),a("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("VO")]),s._v("],\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("this")]),s._v(": globalContext."),a("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("VO")]),s._v("\n}\n")])]),a("p",[s._v("2.初始化的同时，checkscope 函数被创建，保存作用域链到函数的内部属性[[scope]]")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[s._v("    checkscope.[[scope]] = [\n      globalContext."),a("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("VO")]),s._v("\n    ];\n")])]),a("p",[s._v("3.执行 checkscope 函数，创建 checkscope 函数执行上下文，checkscope 函数执行上下文被压入执行上下文栈")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[a("span",{pre:!0,attrs:{class:"hljs-title class_"}},[s._v("ECStack")]),s._v(" = [checkscopeContext, globalContext]\n")])]),a("p",[s._v("4.checkscope 函数执行上下文初始化：")]),a("ol",[a("li",[s._v("复制函数 [[scope]] 属性创建作用域链，")]),a("li",[s._v("用 arguments 创建活动对象，")]),a("li",[s._v("初始化活动对象，即加入形参、函数声明、变量声明，")]),a("li",[s._v("将活动对象压入 checkscope 作用域链顶端。")])]),a("p",[s._v("同时 f 函数被创建，保存作用域链到 f 函数的内部属性[[scope]]")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[s._v("    checkscopeContext = {\n        "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("AO")]),s._v(": {\n            "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("arguments")]),s._v(": {\n                "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("length")]),s._v(": "),a("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("\n            },\n            "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("scope")]),s._v(": "),a("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("undefined")]),s._v(",\n            "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("f")]),s._v(": reference to "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("f")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v("){}\n        },\n        "),a("span",{pre:!0,attrs:{class:"hljs-title class_"}},[s._v("Scope")]),s._v(": ["),a("span",{pre:!0,attrs:{class:"hljs-variable constant_"}},[s._v("AO")]),s._v(", globalContext."),a("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("VO")]),s._v("],\n        "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("this")]),s._v(": "),a("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("undefined")]),s._v("\n    }\n")])]),a("p",[s._v("5.执行 f 函数，创建 f 函数执行上下文，f 函数执行上下文被压入执行上下文栈")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[a("span",{pre:!0,attrs:{class:"hljs-title class_"}},[s._v("ECStack")]),s._v(" = [fContext, checkscopeContext, globalContext]\n")])]),a("p",[s._v("6.f 函数执行上下文初始化, 以下跟第 4 步相同：")]),a("ol",[a("li",[s._v("复制函数 [[scope]] 属性创建作用域链")]),a("li",[s._v("用 arguments 创建活动对象")]),a("li",[s._v("初始化活动对象，即加入形参、函数声明、变量声明")]),a("li",[s._v("将活动对象压入 f 作用域链顶端")])]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[s._v("fContext = {\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("AO")]),s._v(": {\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("arguments")]),s._v(": {\n      "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("length")]),s._v(": "),a("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("\n    }\n  },\n  "),a("span",{pre:!0,attrs:{class:"hljs-title class_"}},[s._v("Scope")]),s._v(": ["),a("span",{pre:!0,attrs:{class:"hljs-variable constant_"}},[s._v("AO")]),s._v(", checkscopeContext."),a("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("AO")]),s._v(", globalContext."),a("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("VO")]),s._v("],\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("this")]),s._v(": "),a("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("undefined")]),s._v("\n}\n")])]),a("p",[s._v("7.f 函数执行，沿着作用域链查找 scope 值，返回 scope 值")]),a("p",[s._v("8.f 函数执行完毕，f 函数上下文从执行上下文栈中弹出")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[a("span",{pre:!0,attrs:{class:"hljs-title class_"}},[s._v("ECStack")]),s._v(" = [checkscopeContext, globalContext]\n")])]),a("p",[s._v("9.checkscope 函数执行完毕，checkscope 执行上下文从执行上下文栈中弹出")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[a("span",{pre:!0,attrs:{class:"hljs-title class_"}},[s._v("ECStack")]),s._v(" = [globalContext]\n")])]),a("p",[s._v("第二段代码就留给大家去尝试模拟它的执行过程。")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" scope = "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'global scope'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("checkscope")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") {\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" scope = "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'local scope'")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("f")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") {\n    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" scope\n  }\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" f\n}\n"),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("checkscope")]),s._v("()()\n")])]),a("p",[s._v("不过，在下一篇《闭包》中也会提及这段代码的执行过程。")]),a("h2",[s._v("下一篇文章")]),a("p",[a("a",{attrs:{href:"#/qingfeng/deep/deep-08"}},[s._v("《08 闭包》")])]),a("h2",[s._v("相关链接")]),a("p",[a("a",{attrs:{href:"#/qingfeng/deep/deep-02"}},[s._v("《02 词法作用域和动态作用域》")])]),a("p",[a("a",{attrs:{href:"#/qingfeng/deep/deep-03"}},[s._v("《03 执行上下文栈》")])]),a("p",[a("a",{attrs:{href:"#/qingfeng/deep/deep-04"}},[s._v("《04 变量对象》")])]),a("p",[a("a",{attrs:{href:"#/qingfeng/deep/deep-05"}},[s._v("《05 作用域链》")])]),a("p",[a("a",{attrs:{href:"#/qingfeng/deep/deep-06"}},[s._v("《06 从 ECMAScript 规范解读 this》")])]),a("h2",[s._v("重要参考")]),a("p",[a("a",{attrs:{href:"https://github.com/kuitos/kuitos.github.io/issues/18"}},[s._v("《一道 js 面试题引发的思考》")])]),a("p",[s._v("本文写的太好，给了我很多启发。感激不尽！")])])])])}],!1,null,null,null);e.default=r.exports}}]);