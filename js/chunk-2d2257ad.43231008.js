(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d2257ad"],{e529:function(s,t,a){"use strict";a.r(t);var p=a("2877"),n=Object(p.a)({},(function(){var s=this;s.$createElement;return s._self._c,s._m(0)}),[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("section",[a("html",[a("head"),a("body",[a("h1",[s._v("你不知道的 npm")]),a("h2",[s._v("依赖包类型")]),a("p",[s._v("npm 目前支持一下几种类型的依赖包管理")]),a("ul",[a("li",[a("code",{pre:!0},[s._v("dependencies")])]),a("li",[a("code",{pre:!0},[s._v("devDependencies")])]),a("li",[a("code",{pre:!0},[s._v("peerDependencies")])]),a("li",[a("code",{pre:!0},[s._v("optionalDependencies")])]),a("li",[a("code",{pre:!0},[s._v("bundledDependencies / bundleDependencies")])])]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-json"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"lodash"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"^4.17.19"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"devDependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"@babel/cli"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"^7.1.0"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"peerDependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"optionalDependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"bundledDependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("]")]),s._v("\n")])]),a("h3",[a("code",{pre:!0},[s._v("dependencies")])]),a("p",[s._v("应用依赖，或者叫做业务依赖，是我们最常用的一种。这种依赖是应用发布后上线所需要的，也就是说其中的依赖项属于线上代码的一部分。比如框架 react，第三方的组件库 ant-design 等。可通过下面的命令来安装:")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-bash"}},[s._v("npm i "),a("span",{pre:!0,attrs:{class:"hljs-variable"}},[s._v("${packageName}")]),s._v(" -S\n")])]),a("h3",[a("code",{pre:!0},[s._v("devDependencies")])]),a("p",[s._v("开发环境依赖。这种依赖只在项目开发时所需要，比如构建工具 webpack、gulp，单元测试工具 jest、mocha 等。可通过下面的命令来安装:")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-bash"}},[s._v("npm i "),a("span",{pre:!0,attrs:{class:"hljs-variable"}},[s._v("${packageName}")]),s._v(" -D\n")])]),a("h3",[a("code",{pre:!0},[s._v("peerDependencies")])]),a("p",[s._v("同行依赖。这种依赖的作用是提示宿主环境去安装插件在"),a("code",{pre:!0},[s._v("peerDependencies")]),s._v("中所指定依赖的包，用于解决插件与所依赖包不一致的问题。")]),a("p",[s._v("听起来可能没有那么好理解，举个例子来说明下。"),a("code",{pre:!0},[s._v("antd@3.19.5")]),s._v("只是提供了一套基于"),a("code",{pre:!0},[s._v("react")]),s._v("的"),a("code",{pre:!0},[s._v("ui")]),s._v("组件库，但它要求宿主环境需要安装指定的"),a("code",{pre:!0},[s._v("react")]),s._v("版本，所以你可以看到 node_modules 中 antd 的"),a("code",{pre:!0},[s._v("package.json")]),s._v("中有这么一项配置:")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-json"}},[a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"peerDependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"react"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('">=16.0.0"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"react-dom"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('">=16.0.0"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n")])]),a("p",[s._v("它要求宿主环境安装大于等于"),a("code",{pre:!0},[s._v("16.0.0")]),s._v("版本的"),a("code",{pre:!0},[s._v("react")]),s._v("，也就是"),a("code",{pre:!0},[s._v("antd")]),s._v("的运行依赖宿主环境提供的该范围的"),a("code",{pre:!0},[s._v("react")]),s._v("安装包。")]),a("blockquote",[a("p",[s._v("在安装插件的时候，peerDependencies 在"),a("code",{pre:!0},[s._v("npm 2.x")]),s._v("和"),a("code",{pre:!0},[s._v("npm 3.x")]),s._v("中表现不一样。npm2.x 会自动安装同等依赖，npm3.x 不再自动安装，会产生警告！手动在"),a("code",{pre:!0},[s._v("package.json")]),s._v("文件中添加依赖项可以解决。")])]),a("h3",[a("code",{pre:!0},[s._v("optionalDependencies")])]),a("p",[s._v("可选依赖。这种依赖中的依赖包即使安装失败了，也不影响整个安装的过程。需要注意的是，"),a("code",{pre:!0},[s._v("optionalDependencies")]),s._v("会覆盖"),a("code",{pre:!0},[s._v("dependencies")]),s._v("中的同名依赖包，所以不要在两个地方都写。")]),a("blockquote",[a("p",[s._v("在实际项目中，如果某个包已经失效，我们通常会寻找它的替代方案。不确定的依赖会增加代码判断和测试难度，所以这个依赖项还是尽量不要使用。")])]),a("h3",[a("code",{pre:!0},[s._v("bundledDependencies / bundleDependencies")])]),a("p",[s._v("打包依赖。如果在打包发布时希望一些依赖包也出现在最终的包里，那么可以将包的名字放在 bundledDependencies 中，bundledDependencies 的值是一个字符串数组，如:")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-json"}},[a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"1.0.0"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"description"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"main"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"index.js"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"echo \\"Error: no test specified\\" && exit 1"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"keywords"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"author"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"license"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"ISC"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"mysql2"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"^2.1.0"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"devDependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"sequelize"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"^5.21.3"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"bundledDependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"mysql2"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"sequelize"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n")])]),a("p",[s._v("执行打包命令 npm pack，在生成的 sequelize-test-1.0.0.tgz 包中，将包含 mysql2 和 sequelize。")]),a("blockquote",[a("p",[s._v("需要注意的是，在 bundledDependencies 中指定的依赖包，必须先在 dependencies 和 devDependencies 声明过，否则打包会报错。")])]),a("h2",[s._v("语义化版本控制")]),a("p",[s._v("为了在软件版本号中包含更多意义，反映代码所做的修改，产生了语义化版本，软件的使用者能从版本号中推测软件做的修改。npm 包使用语义化版控制，我们可安装一定版本范围的 npm 包，npm 会选择和你指定的版本相匹配 的 ("),a("code",{pre:!0},[s._v("latest")]),s._v(")最新版本安装。")]),a("p",[s._v("npm 采用了"),a("code",{pre:!0},[s._v("semver")]),s._v("规范作为依赖版本管理方案。版本号由三部分组成:"),a("code",{pre:!0},[s._v("主版本")]),s._v("、"),a("code",{pre:!0},[s._v("次版本号")]),s._v("、"),a("code",{pre:!0},[s._v("补丁版本号")]),s._v("。变更不同的版本号，代表不同的意义:")]),a("ul",[a("li",[a("code",{pre:!0},[s._v("主版本号（major）")]),s._v("：软件做了不兼容的变更（breaking change 重大变更）")]),a("li",[a("code",{pre:!0},[s._v("次版本号（minor）")]),s._v("：添加功能或者废弃功能，向下兼容，修订号必须归零")]),a("li",[a("code",{pre:!0},[s._v("补丁版本号（patch）")]),s._v("：bug 修复，向下兼容")])]),a("p",[s._v("下面让我们来看下常用的几个版本格式:")]),a("ul",[a("li",[a("code",{pre:!0},[s._v('"compression": "1.7.4"')])])]),a("p",[s._v("表示精确版本号。任何其他版本号都不匹配。在一些比较重要的线上项目中，建议使用这种方式锁定版本。")]),a("ul",[a("li",[a("code",{pre:!0},[s._v('"typescript": "^3.4.3"')])])]),a("p",[s._v("表示兼容补丁和小版本更新的版本号。官方的定义是能够兼容除了最左侧的非 0 版本号之外的其他变化。这句话不是很好理解，举几个例子大家就明白了:")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-text"}},[s._v('"^3.4.3" 等价于 `">= 3.4.3 < 4.0.0"。即只要最左侧的 "3" 不变，其他都可以改变。所以 "3.4.5", "3.6.2" 都可以兼容。\n\n"^0.4.3" 等价于 ">= 0.4.3 < 0.5.0"。因为最左侧的是 "0"，那么只要第二位 "4" 不变，其他的都兼容，比如 "0.4.5" 和 "0.4.99"。\n\n"^0.0.3" 等价于 ">= 0.0.3 < 0.0.4"。大版本号和小版本号都为 "0" ，所以也就等价于精确的 "0.0.3"。\n')])]),a("ul",[a("li",[a("code",{pre:!0},[s._v('"mime-types": "~2.1.24"')])])]),a("p",[s._v("表示只兼容补丁更新的版本号。关于 ~ 的定义分为两部分：如果列出了小版本号（第二位），则只兼容补丁（第三位）的修改；如果没有列出小版本号，则兼容第二和第三位的修改。我们分两种情况理解一下这个定义:")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-text"}},[s._v('"~2.1.24" 列出了小版本号 "1"，因此只兼容第三位的修改，等价于 ">= 2.1.24 < 2.2.0"。\n\n"~2.1" 也列出了小版本号 "2"，因此和上面一样兼容第三位的修改，等价于 ">= 2.1.0 < 2.2.0"。\n\n"~2" 没有列出小版本号，可以兼容第二第三位的修改，因此等价于 ">= 2.0.0 < 3.0.0"\n')])]),a("ul",[a("li",[a("code",{pre:!0},[s._v('"underscore-plus": "1.x"')]),s._v(" "),a("code",{pre:!0},[s._v('"uglify-js": "3.4.x"')])])]),a("p",[s._v("除了上面的"),a("code",{pre:!0},[s._v("x")]),s._v("、"),a("code",{pre:!0},[s._v("X")]),s._v("还有"),a("code",{pre:!0},[s._v("*")]),s._v("和("),a("code",{pre:!0},[s._v("空")]),s._v(")，这些都表示使用通配符的版本号，可以匹配任何内容。具体来说:")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-text"}},[s._v('"*" 、"x" 或者 （空） 表示可以匹配任何版本。\n"1.x", "1.*" 和 "1" 表示匹配主版本号为 "1" 的所有版本，因此等价于 ">= 1.0.0 < 2.0.0"。\n\n"1.2.x", "1.2.*" 和 "1.2" 表示匹配版本号以 "1.2" 开头的所有版本，因此等价于 ">= 1.2.0 < 1.3.0"。\n')])]),a("ul",[a("li",[a("code",{pre:!0},[s._v('"css-tree": "1.0.0-alpha.33"')]),s._v(" "),a("code",{pre:!0},[s._v('"@vue/test-utils": "1.0.0-beta.29"')])])]),a("p",[s._v("有时候为了表达更加确切的版本，还会在版本号后面添加标签或者扩展，来说明是预发布版本或者测试版本等。常见的标签有:")]),a("table",[a("thead",[a("tr",[a("th",[s._v("标签")]),a("th",[s._v("含义")]),a("th",[s._v("补充")])])]),a("tbody",[a("tr",[a("td",[s._v("demo")]),a("td",[s._v("demo 版本")]),a("td",[s._v("可能用于验证问题的版本")])]),a("tr",[a("td",[s._v("dev")]),a("td",[s._v("开发版")]),a("td",[s._v("开发阶段用的，bug 多，体积较大等特点，功能不完善")])]),a("tr",[a("td",[s._v("alpha")]),a("td",[s._v("α 版本")]),a("td",[s._v("预览版，或者叫内部测试版；一般不向外发布，会有很多 bug；一般只有测试人员使用。")])]),a("tr",[a("td",[s._v("beta")]),a("td",[s._v("测试版(β 版本)")]),a("td",[s._v("测试版，或者叫公开测试版；这个阶段的版本会一直加入新的功能；在 alpha 版之后推出。")])]),a("tr",[a("td",[s._v("gamma")]),a("td",[s._v("（γ）伽马版本")]),a("td",[s._v("较 α 和 β 版本有很大的改进，与稳定版相差无几，用户可使用")])]),a("tr",[a("td",[s._v("trial")]),a("td",[s._v("试用版本")]),a("td",[s._v("本软件通常都有时间限制，过期之后用户如果希望继续使用，一般得交纳一定的费用进行注册或购买。有些试用版软件还在功能上做了一定的限制。")])]),a("tr",[a("td",[s._v("csp")]),a("td",[s._v("内容安全版本")]),a("td",[s._v("js 库常用")])]),a("tr",[a("td",[s._v("rc")]),a("td",[s._v("最终测试版本")]),a("td",[s._v("可能成为最终产品的候选版本，如果未出现问题则可发布成为正式版本")])]),a("tr",[a("td",[s._v("latest")]),a("td",[s._v("最新版")]),a("td",[s._v("不指定版本和标签，npm 默认安最新版")])]),a("tr",[a("td",[s._v("stable")]),a("td",[s._v("稳定版")]),a("td")])])]),a("h2",[s._v("npm install 原理分析")]),a("p",[s._v("我们都知道，执行"),a("code",{pre:!0},[s._v("npm install")]),s._v("后，依赖包被安装到了"),a("code",{pre:!0},[s._v("node_modules")]),s._v("中。虽然在实际开发中我们无需十分关注里面具体的细节，但了解"),a("code",{pre:!0},[s._v("node_modules")]),s._v("中的内容可以帮助我们更好的理解"),a("code",{pre:!0},[s._v("npm")]),s._v("安装依赖包的具体机制。")]),a("h3",[s._v("嵌套结构")]),a("p",[s._v("在 npm 的早期版本中，npm 处理依赖的方式简单粗暴，以递归的方式，严格按照 "),a("code",{pre:!0},[s._v("package.json")]),s._v(" 结构以及子依赖包的 "),a("code",{pre:!0},[s._v("package.json")]),s._v(" 结构将依赖安装到他们各自的 "),a("code",{pre:!0},[s._v("node_modules")]),s._v(" 中。")]),a("p",[s._v("举个例子，我们的项目"),a("code",{pre:!0},[s._v("ts-axios")]),s._v("现在依赖了两个模块: "),a("code",{pre:!0},[s._v("axios")]),s._v("、"),a("code",{pre:!0},[s._v("body-parser")]),s._v(":")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-json"}},[a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"ts-axios"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"axios"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"^0.19.0"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"body-parser"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"^1.19.0"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n")])]),a("p",[s._v("axios 依赖了 follow-redirects 和 is-buffer 模块:")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-json"}},[a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"axios"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"follow-redirects"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"1.5.10"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"is-buffer"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"^2.0.2"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n")])]),a("p",[s._v("body-parser 依赖了 bytes 和 content-type 等模块:")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-json"}},[a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"body-parser"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"bytes"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"3.1.0"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"content-type"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"~1.0.4"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"..."')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n")])]),a("p",[s._v("那么，执行 npm install 后，得到的 node_modules 中模块目录结构就是下面这样的：")]),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/24952644/130386982-4a46d9d1-f864-4cb9-9bf1-78813bccd79d.png",alt:"001"}})]),a("p",[s._v("这样的方式优点很明显， "),a("code",{pre:!0},[s._v("node_modules")]),s._v(" 的结构和 "),a("code",{pre:!0},[s._v("package.json")]),s._v(" 结构一一对应，层级结构明显，并且保证了每次安装目录结构都是相同的。")]),a("p",[s._v("但是，试想一下，如果你依赖的模块非常之多，你的 "),a("code",{pre:!0},[s._v("node_modules")]),s._v(" 将非常庞大，嵌套层级非常之深:")]),a("p",[s._v("从上图这种情况，我们不难得出嵌套结构拥有以下缺点：")]),a("ul",[a("li",[s._v("在不同层级的依赖中，可能引用了同一个模块，导致大量冗余")]),a("li",[s._v("嵌套层级过深可能导致不可预知的问题")])]),a("h3",[s._v("扁平结构")]),a("p",[s._v("为了解决以上问题，npm 在 3.x 版本做了一次较大更新。其将早期的嵌套结构改为扁平结构。")]),a("p",[s._v("安装模块时，不管其是直接依赖还是子依赖的依赖，优先将其安装在 "),a("code",{pre:!0},[s._v("node_modules")]),s._v(" 根目录。")]),a("p",[s._v("还是上面的依赖结构，我们在执行 npm install 后将得到下面的目录结构：")]),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/24952644/130386994-edac7de1-82c2-4876-8fec-d2d0f95772c9.png",alt:"002"}})]),a("p",[s._v("此时我们若在模块中又依赖了 "),a("code",{pre:!0},[s._v("is-buffer@2.0.1")]),s._v(" 版本：")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-json"}},[a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"ts-axios"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"axios"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"^0.19.0"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"body-parser"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"^1.19.0"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"is-buffer"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"^2.0.1"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n")])]),a("p",[s._v("当安装到相同模块时，判断已安装的模块版本是否符合新模块的版本范围，如果符合则跳过，不符合则在当前模块的 node_modules 下安装该模块。")]),a("p",[s._v("此时，我们在执行 npm install 后将得到下面的目录结构：")]),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/24952644/130387002-e6a17f49-24f2-4477-baea-ccb2b3fd6caf.png",alt:"003"}})]),a("p",[s._v("对应的，如果我们在项目代码中引用了一个模块，模块查找流程如下：")]),a("ul",[a("li",[s._v("在当前模块路径下搜索")]),a("li",[s._v("在当前模块 node_modules 路径下搜索")]),a("li",[s._v("在上级模块的 node_modules 路径下搜索")]),a("li",[s._v("...")]),a("li",[s._v("直到搜索到全局路径中的 node_modules")])]),a("p",[s._v("假设我们又依赖了一个包 axios2@^0.19.0，而它依赖了包 is-buffer@^2.0.3，则此时的安装结构是下面这样的：")]),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/24952644/130387008-ae028601-ee79-4a6b-94d0-74f8a3706e36.png",alt:"004"}})]),a("p",[s._v("所以 npm 3.x 版本并未完全解决老版本的模块冗余问题，甚至还会带来新的问题。")]),a("p",[s._v("我们在 "),a("code",{pre:!0},[s._v("package.json")]),s._v(" 通常只会锁定大版本，这意味着在某些依赖包小版本更新后，同样可能造成依赖结构的改动，依赖结构的不确定性可能会给程序带来不可预知的问题。")]),a("h3",[s._v("package-lock.json")]),a("p",[s._v("为了解决 "),a("code",{pre:!0},[s._v("npm install")]),s._v(" 的不确定性问题，在 "),a("code",{pre:!0},[s._v("npm 5.x")]),s._v(" 版本新增了 "),a("code",{pre:!0},[s._v("package-lock.json")]),s._v(" 文件，而安装方式还沿用了 "),a("code",{pre:!0},[s._v("npm 3.x")]),s._v(" 的扁平化的方式。")]),a("p",[s._v("package-lock.json 的作用是锁定依赖结构，即只要你目录下有 "),a("code",{pre:!0},[s._v("package-lock.json")]),s._v(" 文件，那么你每次执行 "),a("code",{pre:!0},[s._v("npm install")]),s._v(" 后生成的 "),a("code",{pre:!0},[s._v("node_modules")]),s._v(" 目录结构一定是完全相同的。")]),a("p",[s._v("例如，我们有如下的依赖结构：")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-json"}},[a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"ts-axios"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"axios"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"^0.19.0"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n")])]),a("p",[s._v("在执行 npm install 后生成的 "),a("code",{pre:!0},[s._v("package-lock.json")]),s._v(" 如下：")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-json"}},[a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"ts-axios"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"0.1.0"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"axios"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"0.19.0"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"resolved"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"https://registry.npmjs.org/axios/-/axios-0.19.0.tgz"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"integrity"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"sha512-1uvKqKQta3KBxIz14F2v06AEHZ/dIoeKfbTRkK1E5oqjDnuEerLmYTgJB5AiQZHJcljpg1TuRzdjDR06qNk0DQ=="')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"requires"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"follow-redirects"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"1.5.10"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"is-buffer"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"^2.0.2"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"debug"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"3.1.0"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"resolved"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"https://registry.npmjs.org/debug/-/debug-3.1.0.tgz"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"integrity"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"sha512-OX8XqP7/1a9cqkxYw2yXss15f26NKWBpDXQd0/uK/KPqdQhxbPa994hnzjcE2VqQpDslf55723cKPUOGSmMY3g=="')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"requires"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"ms"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"2.0.0"')]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"follow-redirects"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"1.5.10"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"resolved"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"https://registry.npmjs.org/follow-redirects/-/follow-redirects-1.5.10.tgz"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"integrity"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"sha512-0V5l4Cizzvqt5D44aTXbFZz+FtyXV1vrDN6qrelxtfYQKW0KO0W2T/hkE8xvGa/540LkZlkaUjO4ailYTFtHVQ=="')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"requires"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"debug"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"=3.1.0"')]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"is-buffer"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"2.0.3"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"resolved"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"https://registry.npmjs.org/is-buffer/-/is-buffer-2.0.3.tgz"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"integrity"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"sha512-U15Q7MXTuZlrbymiz95PJpZxu8IlipAp4dtS3wOdgPXx3mqBnslrWU14kxfHB+Py/+2PVKSr37dMAgM2A4uArw=="')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"ms"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"2.0.0"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"resolved"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"https://registry.npmjs.org/ms/-/ms-2.0.0.tgz"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"integrity"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"sha1-VgiurfwAvmwpAd9fmGF4jeDVl8g="')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n")])]),a("p",[s._v("最外面的两个属性 "),a("code",{pre:!0},[s._v("name")]),s._v(" 、"),a("code",{pre:!0},[s._v("version")]),s._v(" 同 "),a("code",{pre:!0},[s._v("package.json")]),s._v(" 中的 "),a("code",{pre:!0},[s._v("name")]),s._v(" 和 "),a("code",{pre:!0},[s._v("version")]),s._v(" ，用于描述当前包名称和版本。")]),a("p",[a("code",{pre:!0},[s._v("dependencies")]),s._v(" 是一个对象，对象和 "),a("code",{pre:!0},[s._v("node_modules")]),s._v(" 中的包结构一一对应，对象的 "),a("code",{pre:!0},[s._v("key")]),s._v(" 为包名称，值为包的一些描述信息：")]),a("ul",[a("li",[a("code",{pre:!0},[s._v("version")]),s._v(": 包唯一的版本号")]),a("li",[a("code",{pre:!0},[s._v("resolved")]),s._v(": 安装来源")]),a("li",[a("code",{pre:!0},[s._v("integrity")]),s._v(": 表明包完整性的 hash 值（验证包是否已失效）")]),a("li",[a("code",{pre:!0},[s._v("requires")]),s._v(": 依赖包所需要的所有依赖项，与子依赖的 package.json 中")]),a("li",[a("code",{pre:!0},[s._v("dependencies")]),s._v("的依赖项相同。")]),a("li",[a("code",{pre:!0},[s._v("dependencies")]),s._v(": 依赖包 node_modules 中依赖的包，与顶层的 dependencies 一样的结构")])]),a("p",[s._v("这里注意，并不是所有的子依赖都有 "),a("code",{pre:!0},[s._v("dependencies")]),s._v(" 属性，只有子依赖的依赖和当前已安装在根目录的 "),a("code",{pre:!0},[s._v("node_modules")]),s._v(" 中的依赖冲突之后，才会有这个属性。")]),a("p",[s._v("通过以上几个步骤，说明"),a("code",{pre:!0},[s._v("package-lock.json")]),s._v("文件和"),a("code",{pre:!0},[s._v("node_modules")]),s._v("目录结构是一一对应的，即项目目录下存在"),a("code",{pre:!0},[s._v("package-lock.json")]),s._v("可以让每次安装生成的依赖目录结构保持相同。")]),a("p",[s._v("在开发一个应用时，建议把"),a("code",{pre:!0},[s._v("package-lock.json")]),s._v("文件提交到代码版本仓库，从而让你的团队成员、运维部署人员或"),a("code",{pre:!0},[s._v("CI系统")]),s._v("可以在执行"),a("code",{pre:!0},[s._v("npm")]),s._v(" install 时安装的依赖版本都是一致的。")]),a("h2",[s._v("npm scripts 脚本")]),a("p",[a("code",{pre:!0},[s._v("脚本功能")]),s._v("是 npm 最强大、最常用的功能之一。")]),a("p",[s._v("npm 允许在"),a("code",{pre:!0},[s._v("package.json")]),s._v("文件中使用"),a("code",{pre:!0},[s._v("scripts")]),s._v("字段来定义脚本命令。以"),a("code",{pre:!0},[s._v("vue-cli3")]),s._v("为例:")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-json"}},[a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"serve"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"vue-cli-service serve"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"vue-cli-service build"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"lint"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"vue-cli-service lint"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"test:unit"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"vue-cli-service test:unit"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n")])]),a("p",[s._v("这样就可以通过"),a("code",{pre:!0},[s._v("npm run serve")]),s._v("脚本替代"),a("code",{pre:!0},[s._v("vue-cli-service serve")]),s._v("脚本来启动项目，而无需每次都敲一遍冗长的脚本。")]),a("h3",[s._v("原理")]),a("p",[s._v("这里我们参考一下阮老师的文章:")]),a("blockquote",[a("p",[s._v("npm 脚本的原理非常简单。每当执行 npm run，就会自动新建一个 Shell，在这个 Shell 里面执行指定的脚本命令。因此，只要是 Shell（一般是 Bash）可以运行的命令，就可以写在 npm 脚本里面。 比较特别的是，npm run 新建的这个 Shell，会将当前目录的 node_modules/.bin 子目录加入 PATH 变量，执行结束后，再将 PATH 变量恢复原样。")])]),a("h3",[s._v("传入参数")]),a("p",[s._v("在原有脚本后面加上 "),a("code",{pre:!0},[s._v("--")]),s._v(" 分隔符, 后面再加上参数，就可以将参数传递给 script 命令了，比如 eslint 内置了代码风格自动修复模式，只需给它传入 "),a("code",{pre:!0},[s._v("--fix")]),s._v(" 参数即可，我们可以这样写:")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-json"}},[a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"lint"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"vue-cli-service lint --fix"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n")])]),a("p",[s._v("除了第一个可执行的命令，以空格分割的任何字符串（除了一些 shell 的语法）都是参数，并且都能通过"),a("code",{pre:!0},[s._v("process.argv")]),s._v("属性访问。")]),a("blockquote",[a("p",[a("code",{pre:!0},[s._v("process.argv")]),s._v(" 属性返回一个数组，其中包含当启动 Node.js 进程时传入的命令行参数。 第一个元素是 "),a("code",{pre:!0},[s._v("process.execPath")]),s._v("，表示启动 node 进程的可执行文件的绝对路径名。第二个元素为当前执行的 JavaScript 文件路径。剩余的元素为其他命令行参数。")])]),a("h3",[s._v("执行顺序")]),a("p",[s._v("如果 npm 脚本里面需要执行多个任务，那么需要明确它们的执行顺序。")]),a("p",[s._v("如果是串行执行，即要求前一个任务执行成功之后才能执行下一个任务。使用"),a("code",{pre:!0},[s._v("&&")]),s._v("符号连接。")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-bash"}},[s._v("npm run script1 && npm run script2\n")])]),a("blockquote",[a("p",[s._v("串行命令执行过程中，只要一个命令执行失败，则整个脚本将立刻终止。")])]),a("p",[s._v("如果是并行执行，即多个任务可以同时执行。使用"),a("code",{pre:!0},[s._v("&")]),s._v("符号来连接。")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-bash"}},[s._v("npm run script1 & npm run script2\n")])]),a("h3",[s._v("钩子")]),a("p",[s._v("这里的钩子和"),a("code",{pre:!0},[s._v("vue")]),s._v("或"),a("code",{pre:!0},[s._v("react")]),s._v("里面的生命周期有点相似。")]),a("p",[s._v("npm 脚本有"),a("code",{pre:!0},[s._v("pre")]),s._v("和"),a("code",{pre:!0},[s._v("post")]),s._v("两个钩子。在执行 npm scripts 命令（无论是自定义还是内置）时，都经历了 pre 和 post 两个钩子，在这两个钩子中可以定义某个命令执行前后的命令。")]),a("p",[s._v("比如，在用户执行"),a("code",{pre:!0},[s._v("npm run build")]),s._v("的时候，会自动按照下面的顺序执行。")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-bash"}},[s._v("npm run prebuild && npm run build && npm run postbuild\n")])]),a("p",[s._v("当然，如果没有指定"),a("code",{pre:!0},[s._v("prebuild")]),s._v("、"),a("code",{pre:!0},[s._v("postbuild")]),s._v("，会默默的跳过。如果想要指定钩子，必须严格按照 pre 和 post 前缀来添加。")]),a("h3",[s._v("环境变量")]),a("p",[s._v("npm 脚本有一个非常强大的功能，就是可以使用 npm 的内部变量。")]),a("p",[s._v("在执行"),a("code",{pre:!0},[s._v("npm run")]),s._v("脚本时，npm 会设置一些特殊的"),a("code",{pre:!0},[s._v("env")]),s._v("环境变量。其中 package.json 中的所有字段，都会被设置为以"),a("code",{pre:!0},[s._v("npm_package_")]),s._v(" 开头的环境变量。比如 package.json 中有如下字段内容：")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-json"}},[a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"sequelize-test"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"1.0.0"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"description"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"sequelize测试"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"main"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"index.js"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"echo \\"Error: no test specified\\" && exit 1"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"keywords"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"author"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"license"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"ISC"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"devDependencies"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"mysql2"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"^2.1.0"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"sequelize"')]),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"^5.21.3"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-punctuation"}},[s._v("}")]),s._v("\n")])]),a("p",[s._v("那么，变量"),a("code",{pre:!0},[s._v("npm_package_name")]),s._v("返回"),a("code",{pre:!0},[s._v("sequelize-test")]),s._v("，变量"),a("code",{pre:!0},[s._v("npm_package_description")]),s._v("返回 sequelize 测试。也就是:")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 这两个是在node环境环境执行 非浏览器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// test.js  执行 node test.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-variable language_"}},[s._v("console")]),s._v("."),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("log")]),s._v("(process."),a("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("env")]),s._v("."),a("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("npm_package_name")]),s._v(") "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// sequelize-test")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"hljs-variable language_"}},[s._v("console")]),s._v("."),a("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("log")]),s._v("(process."),a("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("env")]),s._v("."),a("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("npm_package_description")]),s._v(") "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// sequelize测试")]),s._v("\n")])]),a("h2",[s._v("npm 配置")]),a("p",[s._v("npm 从以下来源获取配置信息（优先级由高到低）：")]),a("h3",[a("code",{pre:!0},[s._v("命令行")])]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-bash"}},[s._v("npm run dev --foo=bar\n")])]),a("p",[s._v("执行上述命令，会将配置项"),a("code",{pre:!0},[s._v("foo")]),s._v("的值设为"),a("code",{pre:!0},[s._v("bar")]),s._v("，通过"),a("code",{pre:!0},[s._v("process.env.npm_config_foo")]),s._v("可以访问其配置值。这个时候的 foo 配置值将覆盖所有其他来源存在的 foo 配置值。")]),a("h3",[a("code",{pre:!0},[s._v("环境变量")])]),a("p",[s._v("如果 env 环境变量中存在以"),a("code",{pre:!0},[s._v("npm_config_")]),s._v("为前缀的环境变量，则会被识别为 npm 的配置属性。比如，环境变量中的"),a("code",{pre:!0},[s._v("npm_config_foo=bar")]),s._v(" 将会设置配置参数 "),a("code",{pre:!0},[s._v("foo")]),s._v(' 的值为 "'),a("code",{pre:!0},[s._v("bar")]),s._v('"。')]),a("p",[s._v("如果只指定了参数名却没有指定任何值的配置参数，其值将会被设置为 "),a("code",{pre:!0},[s._v("true")]),s._v("。")]),a("h3",[a("code",{pre:!0},[s._v("npmrc文件")])]),a("p",[s._v("通过修改 "),a("code",{pre:!0},[s._v("npmrc")]),s._v(" 文件可以直接修改配置。系统中存在多个 npmrc 文件，这些 npmrc 文件被访问的优先级从高到低的顺序为:")]),a("ul",[a("li",[a("code",{pre:!0},[s._v("项目配置文件")])])]),a("p",[s._v("只作用在本项目下。在其他项目中，这些配置不生效。通过创建这个.npmrc 文件可以统一团队的 "),a("code",{pre:!0},[s._v("npm")]),s._v(" 配置规范。路径为"),a("code",{pre:!0},[s._v("/path/to/my/project/.npmrc")]),s._v("。")]),a("ul",[a("li",[a("code",{pre:!0},[s._v("用户配置文件")])])]),a("p",[s._v("默认为"),a("code",{pre:!0},[s._v("~/.npmrc/")]),s._v("，可通过"),a("code",{pre:!0},[s._v("npm config get userconfig")]),s._v("查看存放的路径。")]),a("ul",[a("li",[a("code",{pre:!0},[s._v("全局配置文件")])])]),a("p",[s._v("通过"),a("code",{pre:!0},[s._v("npm config get globalconfig")]),s._v("可以查看具体存放的路径。")]),a("ul",[a("li",[a("code",{pre:!0},[s._v("npm 内置的配置文件")])])]),a("p",[s._v("这是一个不可更改的内置配置文件，为了维护者以标准和一致的方式覆盖默认配置。"),a("code",{pre:!0},[s._v("mac")]),s._v("下的路径为"),a("code",{pre:!0},[s._v("/path/to/npm/npmrc")]),s._v("。")]),a("h3",[a("code",{pre:!0},[s._v("默认配置")])]),a("p",[s._v("通过"),a("code",{pre:!0},[s._v("npm config ls -l")]),s._v("查看 npm 内部的默认配置参数。如果命令行、环境变量、所有配置文件都没有配置参数，则使用默认参数值。")]),a("h2",[s._v("npm config 指令")]),a("h3",[a("code",{pre:!0},[s._v("set")])]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-bash"}},[s._v("npm config "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("set")]),s._v(" <key> <value> [-g|--global]\nnpm config "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("set")]),s._v(" registry <url>  "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 指定下载 npm 包的来源，默认为 https://registry.npmjs.org/ ，可以指定私有源")]),s._v("\n")])]),a("p",[s._v("设置配置参数 key 的值为 value，如果省略 value，key 会被设置为 true。")]),a("h3",[a("code",{pre:!0},[s._v("get")])]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-bash"}},[s._v("npm config get <key>\n")])]),a("p",[s._v("查看配置参数 key 的值。")]),a("h3",[a("code",{pre:!0},[s._v("delete")])]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-bash"}},[s._v("npm config delete <key>\n")])]),a("p",[s._v("删除配置参数 key")]),a("h3",[a("code",{pre:!0},[s._v("list")])]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-bash"}},[s._v("npm config list [-l] [--json]\n")])]),a("p",[s._v("查看所有设置过的配置参数。使用 -l 查看所有设置过的以及默认的配置参数。使用 --json 以 json 格式查看。")]),a("h3",[s._v("edit")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-bash"}},[s._v("npm config edit\n")])]),a("p",[s._v("在编辑器中打开 npmrc 文件，使用 --global 参数打开全局 npmrc 文件。")])])])])}],!1,null,null,null);t.default=n.exports}}]);